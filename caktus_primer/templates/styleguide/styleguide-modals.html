{% extends "styleguide/styleguide.html" %}

{% load styleguide_tags %}
<head>
    {% block extra-css %}
    <style>
        dialog {
            position: relative;
            padding: 2em 2em;
            border: none;
            box-shadow: 2px 3px 4px rgba(0, 0, 0, 0.1);
        }

        dialog::backdrop {
            background: #2B2B28;
            opacity: 0.7;
        }

        button[aria-label="close"] {
            position: absolute;
            height: 44pt; /* Per Apple's HIG we should maintain a tappable area of 44pt by 44pt */
            width: 44pt;
            top: 0;
            right: 0;
            color: black;
            border: none;
            background: transparent;
            box-shadow: none;
            font-weight: bold;
        }

        button[aria-label="close"]:hover {
            color: red;
        }
        
        @media all and (max-width: 600px) {
            dialog {
                width: 90% !important;
            }
        }
    </style>
    {% endblock %}
</head>
{% block styleguide_content %}
    <h1 class="styleguide-page-title">Modals</h1>
    <p>HTML 5.2 now includes a <code>{% filter force_escape %}<dialog>{% endfilter %}</code> element we can leverage to create modals, or an absolutely positioned and horizontally centered content box that appears on top of other content on a page.</p>
    <p>The purpose of a modal can be varied; whether it serves as an alert message or a form, we use modals to direct a user's attention at whatever message or task is at hand.</p>
    <p>There are 3 browser API methods we can now use with <code>{% filter force_escape %}<dialog>{% endfilter %}</code> elements: </p>
        <ul>
            <li><code>{% filter force_escape %}showModal(){% endfilter %}</code> This method will display the element as a modal. It will be displayed at the center of the page by default, and it resides in the top layer, which prevents interference by z-index, relative position and overflow of the parent element.</li>
            <li><code>{% filter force_escape %}show(){% endfilter %}</code> This method reveals the element in accordance to its position in the DOM flow.</li>
            <li><code>{% filter force_escape %}close(){% endfilter %}</code> This method will close a dialog. You can optionally pass in a <code>{% filter force_escape %}returnValue{% endfilter %}</code> parameter which will update the returnValue property on the dialog.</code></li>
        </ul>
    <p>Additionally, there is a new CSS pseudo class called <code>{% filter force_escape %}::backdrop{% endfilter %}</code> which allows us to easily style our modal backdrops. See the documentation <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/::backdrop" target="_blank">here</a>.</p>

    <p>For further reading on the <code>{% filter force_escape %}<dialog>{% endfilter %}</code> element, see <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog" target="_blank">here</a>.</p>
    <p>To ensure browser compatibility, we are including a <a href="https://github.com/GoogleChrome/dialog-polyfill" target="_blank">polyfill</a> so that this approach works on all browsers, including IE 9.</p>
    <h2 class="styleguide-heading">Small Modal</h2>
    <div id="smallDialog">
        <button type="button" class="btn-open" id="modal_open" aria-label="open">Open Small Modal</button>
        <dialog>
            <h3>Small Modal Window</h3>
            <p>Morbi quis nibh quam. Sed ipsum lacus, ultrices at rutrum in, dapibus in velit. Nunc dignissim, arcu in lacinia tempus, eros mi eleifend massa, ut elementum ante nulla id leo.</p>
            <button type="button" class="btn-close" id="modal_close" aria-label="close">X</button>
        </dialog>
    </div>

    <h2 class="styleguide-heading">Medium Modal</h2>
    <div id="mediumDialog">
        <button type="button" class="btn-open" id="modal_open" aria-label="open">Open Medium Modal</button>
        <dialog>
            <h3>Medium Modal Window</h3>
            <p>Morbi quis nibh quam. Sed ipsum lacus, ultrices at rutrum in, dapibus in velit. Nunc dignissim, arcu in lacinia tempus, eros mi eleifend massa, ut elementum ante nulla id leo.</p>
            <button type="button" class="btn-close" id="modal_close" aria-label="close">X</button>
        </dialog>
    </div>

    <h2 class="styleguide-heading">Large Modal</h2>
    <div id="largeDialog">
        <button type="button" class="btn-open" id="modal_open" aria-label="open">Open Large Modal</button>
        <dialog>
            <h3>Large Modal Window</h3>
            <p>Morbi quis nibh quam. Sed ipsum lacus, ultrices at rutrum in, dapibus in velit. Nunc dignissim, arcu in lacinia tempus, eros mi eleifend massa, ut elementum ante nulla id leo.</p>
            <p>Phasellus ultricies varius quam. Suspendisse fringilla massa sapien, vel ornare diam bibendum nec. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</p>
            <button type="button" class="btn-close" id="modal_close" aria-label="close">X</button>
        </dialog>
    </div>

    <h2 class="styleguide-heading">Modal with a Form</h2>
        <p>Your modal can contain a variety of things, including forms!</p>
        <div id="formDialog">
            <button type="button" class="btn-open" id="modal_open" aria-label="open">Open Form Modal</button>
            <dialog>
                <h3>Modal Form Title</h3>
                <form>
                    <fieldset>
                        {% for field in create_user_form %}
                            {{ field }}
                            {{ field.label_tag }}
                        {% endfor %}
                        <input type=submit value="Save" formnovalidate>
                    </fieldset>
                </form>
                <button type="button" class="btn-close" id="modal_close" aria-label="close">X</button>
            </dialog>
        </div>

    <h2 class="styleguide-heading">Usage</h2>
    {% example wide=True %}
        <!-- HTML -->
        <div id="mediumDialog">
            <button type="button" class="btn-open" id="modal_open" aria-label="open">Open Medium Modal</button>
            <dialog>
                <h3>Medium Modal Window</h3>
                <p>Morbi quis nibh quam. Sed ipsum lacus, ultrices at rutrum in, dapibus in velit. Nunc dignissim, arcu in lacinia tempus, eros mi eleifend massa, ut elementum ante nulla id leo.</p>
                <button type="button" class="btn-close" id="modal_close" aria-label="close">X</button>
            </dialog>
        </div>
        {% endexample %}

{% endblock %}

{% block extra-js %}
<script type="text/javascript">
'use strict'

let clickEvents = ['click', 'mousedown', 'touchstart', 'dblclick']


class Modal {
    constructor(id) {
        this.name = 'Modal'
        this.options = {}
        this.container = document.getElementById(id) || null
        if (this.container) {
            this.openTarget = this.container.querySelector('[aria-label="open"]')
            this.dialogTarget = this.container.getElementsByTagName('dialog')[0]
            this.closeTarget = this.container.querySelector('[aria-label="close"]')
        }
        else {
            return
        }

        clickEvents.forEach((n) => (this.openTarget.addEventListener(n, (e) => { this.handleClick(e)})))
        
        clickEvents.forEach((n) => (this.closeTarget.addEventListener(n, (e) => { this.closeModal(e)})))
        
        document.addEventListener('keypress', (e) => { 
            // Escape key
            if (e.keyCode == 27) {
                this.closeModal(e) 
            }
        })
    }

    handleClick() {
        this.dialogTarget.showModal()
        document.body.style.overflow = 'hidden';
    }

    closeModal() {
        this.dialogTarget.close()
        document.body.style.overflow = '';
    }

}

class LargeModal extends Modal {
    constructor(id) {
        super(id)
        this.options['size'] = '80%'
        this.name = 'LargeModal'
        this.dialogTarget.style.width = this.options['size']
    }
}

class MediumModal extends Modal {
    constructor(id) {
        super(id)
        this.options['size'] = '50%'
        this.name = 'MediumModal'
        this.dialogTarget.style.width = this.options['size']
    }
}

class SmallModal extends Modal {
    constructor(id) {
        super(id)
        this.options['size'] = '30%'
        this.name = 'MediumModal'
        this.dialogTarget.style.width = this.options['size']
    }
}


let largeModal = new LargeModal('largeDialog')
let mediumModal = new MediumModal('mediumDialog')
let smallModal = new SmallModal('smallDialog')
let formModal = new MediumModal('formDialog')

</script>
{% endblock %}

















